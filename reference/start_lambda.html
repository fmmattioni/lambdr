<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Set-up logging and a Lambda runtime, and start listening for events — start_lambda • lambdr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Set-up logging and a Lambda runtime, and start listening for events — start_lambda" />
<meta property="og:description" content="Runs the following three functions in order:
setup_logging
setup_lambda
start_listening


See vignette(&quot;lambda-runtime-in-container&quot;, package = &quot;lambdr&quot;) for an
example of how to use this function to place an R Lambda Runtime in a
container." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lambdr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/api-gateway-invocations.html">API Gateway Invocations</a>
    </li>
    <li>
      <a href="../articles/lambda-runtime-in-container.html">Placing an R Lambda Runtime in a Container</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mdneuzerling/lambdr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Set-up logging and a Lambda runtime, and start listening for events</h1>
    <small class="dont-index">Source: <a href='https://github.com/mdneuzerling/lambdr/blob/master/R/start-lambda.R'><code>R/start-lambda.R</code></a></small>
    <div class="hidden name"><code>start_lambda.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Runs the following three functions in order:</p><ul>
<li><p><code><a href='setup_logging.html'>setup_logging</a></code></p></li>
<li><p><code><a href='setup_lambda.html'>setup_lambda</a></code></p></li>
<li><p><code><a href='start_listening.html'>start_listening</a></code></p></li>
</ul>

<p>See <code><a href='../articles/lambda-runtime-in-container.html'>vignette("lambda-runtime-in-container", package = "lambdr")</a></code> for an
example of how to use this function to place an R Lambda Runtime in a
container.</p>
    </div>

    <pre class="usage"><span class='fu'>start_lambda</span><span class='op'>(</span>
  log_threshold <span class='op'>=</span> <span class='fu'>logger</span><span class='fu'>::</span><span class='va'><a href='https://daroczig.github.io/logger/reference/log_levels.html'>INFO</a></span>,
  handler <span class='op'>=</span> <span class='cn'>NULL</span>,
  runtime_api <span class='op'>=</span> <span class='cn'>NULL</span>,
  task_root <span class='op'>=</span> <span class='cn'>NULL</span>,
  deserialiser <span class='op'>=</span> <span class='cn'>NULL</span>,
  serialiser <span class='op'>=</span> <span class='cn'>NULL</span>,
  decode_base64 <span class='op'>=</span> <span class='cn'>TRUE</span>,
  timeout_seconds <span class='op'>=</span> <span class='cn'>NULL</span>,
  environ <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>log_threshold</th>
      <td><p>Threshold for recording and displaying log entries.
Defaults to <code><a href='https://daroczig.github.io/logger/reference/log_levels.html'>logger::INFO</a></code>. To debug a failing Lambda container, set this
to <code><a href='https://daroczig.github.io/logger/reference/log_levels.html'>logger::DEBUG</a></code> to log verbose information about how each request is
processed.</p></td>
    </tr>
    <tr>
      <th>handler</th>
      <td><p>character. Name of function to use for processing inputs from
events. This argument is provided for debugging and testing only. The
"_HANDLER" environment variable, as configured in AWS, will always override
this value if present.</p></td>
    </tr>
    <tr>
      <th>runtime_api</th>
      <td><p>character. Used as the host in the various endpoints used
by AWS Lambda. This argument is provided for debugging and testing only.
The "AWS_LAMBDA_RUNTIME_API" environment variable, as configured by AWS,
will always override this value if present.</p></td>
    </tr>
    <tr>
      <th>task_root</th>
      <td><p>character. Defines the path to the Lambda function code.
This argument is provided for debugging and testing only. The
"LAMBDA_TASK_ROOT" environment variable, as configured by AWS, will always
override this value if present.</p></td>
    </tr>
    <tr>
      <th>deserialiser</th>
      <td><p>function for deserialising the body of the event.
By default, will attempt to deserialise the body as JSON, based on whether
the input is coming from an API Gateway, scheduled Cloudwatch event, or
direct. To use the body as is, pass the <code>identity</code> function. If input is
coming via an API Gateway this will require some complicated parsing (see
below).</p></td>
    </tr>
    <tr>
      <th>serialiser</th>
      <td><p>function for serialising the result before sending.
By default, will attempt to serialise the body as JSON, based on the
request type. To send the result as is, pass the <code>identity</code> function.</p></td>
    </tr>
    <tr>
      <th>decode_base64</th>
      <td><p>logical. Should Base64 input be automatically decoded?
This is only used for events coming via an API Gateway. Complicated input
(such as images) may be better left as is, so that the handler function can
deal with it appropriately. Defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>timeout_seconds</th>
      <td><p>If set, the function will stop listening for events
after this timeout. The timeout is checked between events, so this won't
interrupt the function while it is waiting for a new event. This argument
is provided for testing purposes, and shouldn't otherwise need to be set:
AWS should handle the shutdown of idle Lambda instances.</p></td>
    </tr>
    <tr>
      <th>environ</th>
      <td><p>environment in which to search for the function given by the
handler. Defaults to the parent frame.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="aws-lambda-variables"><a class="anchor" href="#aws-lambda-variables"></a>AWS Lambda variables</h2>

    


<p>The <code><a href='setup_lambda.html'>setup_lambda</a></code> function, which is also run as part of
<code>start_lambda</code> configures the R session for Lambda based on
environment variables made available by Lambda. The following environment
variables are available:</p><ul>
<li><p>Lambda Runtime API, available as the "AWS_LAMBDA_RUNTIME_API" environment
variable, is the host of the various HTTP endpoints through which the
runtime interacts with Lambda.</p></li>
<li><p>Lambda Task Root, available as the "LAMBDA_TASK_ROOT" environment variable,
defines the path to the Lambda function code. It isn't used in container
environments with a custom runtime, as that runtime is responsible for
finding and sourcing the function code.</p></li>
<li><p>The handler, available as the "_HANDLER" environment variable, is
interpreted by R as the function that is executed when the Lambda is
called. This value could be anything, as the interpretation is solely up
to the runtime, so requiring it to be a function is a standard imposed by
this package.</p></li>
</ul>

    <h2 class="hasAnchor" id="event-context"><a class="anchor" href="#event-context"></a>Event context</h2>

    

<p>The <em>context</em> of an event is a list of metadata about the invocation. It is
derived from the headers of a next event invocation response. It consists of:</p><ul>
<li><p><code>aws_request_id</code> - The identifier of the invocation request</p></li>
<li><p><code>invoked_function_arn</code> – The Amazon Resource Name (ARN) that's used to
invoke the function. Indicates if the invoker specified a version number or
alias.</p></li>
</ul>

<p>If the handler function accepts a <code>context</code> argument then it will
automatically receive at runtime a named list consisting of these values
along with the arguments in the body (if any). For example, a function such
as <code>my_func(x, context)</code> will receive the context argument automatically.
The <code>context</code> argument must be named (<code>...</code> will not work).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># A general usage pattern involves sourcing necessary functions and running</span>
<span class='co'># this `start_lambda` in a `runtime.R` file which is then executed to start</span>
<span class='co'># the runtime. In the following example, the function handler can be set to</span>
<span class='co'># "lambda" either as the container `CMD`, or configured through AWS Lambda.</span>

<span class='va'>parity</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>number</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>parity <span class='op'>=</span> <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>number</span><span class='op'>)</span> <span class='op'>%%</span> <span class='fl'>2</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='st'>"even"</span> <span class='kw'>else</span> <span class='st'>"odd"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>start_lambda</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Neuzerling.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


